<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlook邮件管理系统</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Outfit:wght@500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/index.css">
</head>
<body>
    <div class="app-container">
        <!-- 左侧菜单 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>📧 邮件管理</h1>
                <p>Outlook邮件管理系统</p>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="showPage('accounts', this)">
                    <span class="icon">👥</span>
                    邮箱账户
                </button>
                <button class="nav-item" onclick="showPage('addAccount', this)">
                    <span class="icon">➕</span>
                    添加账户
                </button>
                <button class="nav-item" onclick="showPage('batchAdd', this)">
                    <span class="icon">📦</span>
                    批量添加
                </button>
                <button class="nav-item" onclick="showPage('apiDocs', this)">
                    <span class="icon">📖</span>
                    API管理
                </button>
            </nav>
            <div id="openedAccountsPanel" class="opened-accounts-panel hidden">
                <div class="opened-accounts-header">
                    <span class="opened-accounts-title">快捷邮箱</span>
                    <span id="openedAccountsCount" class="opened-accounts-count">0</span>
                </div>
                <div id="openedAccountsList" class="opened-accounts-list"></div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="main-header">
                <h2 id="pageTitle">邮箱账户管理</h2>
                <div id="headerActions">
                    <a class="btn btn-secondary btn-sm" href="/admin/auth/logout">
                        <span>↩</span>
                        退出后台
                    </a>
                </div>
            </div>

            <div class="main-body">
                <!-- 邮箱账户列表页面 -->
                <div id="accountsPage" class="page">
                    <div class="card">
                        <div class="flex justify-end mb-4">
                            <div class="flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="showPage('addAccount')">
                                    <span>➕</span>
                                    添加账户
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="showPage('batchAdd')">
                                    <span>📦</span>
                                    批量添加
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="loadAccounts()">
                                    <span>🔄</span>
                                    刷新列表
                                </button>
                            </div>
                        </div>
                        
                        <!-- 搜索和过滤区域 -->
                        <div class="search-container">
                            <div class="flex gap-3 mb-4">
                                <div class="flex-1">
                                    <input type="text" id="emailSearch" class="form-control" placeholder="按邮箱账号搜索..." onkeypress="handleSearchKeyPress(event)">
                                </div>
                                <div class="flex-1">
                                    <input type="text" id="tagSearch" class="form-control" placeholder="按标签搜索..." onkeypress="handleSearchKeyPress(event)">
                                </div>
                                <button class="btn btn-primary" onclick="searchAccounts()">
                                    <span>🔍</span>
                                    搜索
                                </button>
                                <button class="btn btn-secondary" onclick="clearSearch()">
                                    <span>🗑️</span>
                                    清除
                                </button>
                            </div>
                        </div>

                        <div class="token-refresh-toolbar mb-4">
                            <label class="token-refresh-check">
                                <input type="checkbox" id="tokenRefreshEnabled">
                                启用定时刷新RT
                            </label>
                            <div class="token-refresh-interval">
                                <span>每</span>
                                <input type="number" id="tokenRefreshInterval" min="1" step="1" value="12">
                                <select id="tokenRefreshUnit" class="form-control token-refresh-unit">
                                    <option value="minute">分钟</option>
                                    <option value="hour" selected>小时</option>
                                    <option value="day">天</option>
                                </select>
                                <span>刷新一次</span>
                            </div>
                            <button class="btn btn-secondary btn-sm" id="saveTokenRefreshSettingsBtn" onclick="saveTokenRefreshSettings()">
                                <span>💾</span>
                                保存定时设置
                            </button>
                            <button class="btn btn-primary btn-sm" id="refreshAllTokensBtn" onclick="refreshAllAccountTokens()">
                                <span>🔁</span>
                                全部刷新RT
                            </button>
                            <span class="token-refresh-hint" id="tokenRefreshScheduleInfo">定时刷新未配置</span>
                        </div>
                        
                        <!-- 统计信息 -->
                        <div id="accountsStats" class="mb-4" style="display: none;">
                            <div class="flex gap-4 text-sm">
                                <span>总数：<strong id="totalAccounts">0</strong></span>
                                <span>当前页：<strong id="currentPage">1</strong></span>
                                <span>每页：<strong id="pageSize">10</strong></span>
                            </div>
                        </div>

                        <div id="accountsList" class="account-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                正在加载账户列表...
                            </div>
                        </div>
                        
                        <!-- 分页控件 -->
                        <div id="accountsPagination" class="pagination" style="display: none;">
                            <button class="btn btn-sm" id="prevPageBtn" onclick="changePage('prev')" disabled>
                                <span>←</span>
                                上一页
                            </button>
                            <div id="pageNumbers" class="flex gap-1"></div>
                            <button class="btn btn-sm" id="nextPageBtn" onclick="changePage('next')">
                                下一页
                                <span>→</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 添加单个账户页面 -->
                <div id="addAccountPage" class="page hidden">
                    <div class="card">
                        <div class="flex justify-end mb-4">
                            <button class="btn btn-secondary btn-sm" onclick="showPage('accounts')">
                                <span>←</span>
                                返回列表
                            </button>
                        </div>

                        <div style="max-width: 600px;">
                            <div class="form-group">
                                <label class="form-label">邮箱地址 *</label>
                                <input type="email" id="email" class="form-input" placeholder="example@outlook.com" required>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">请输入有效的Outlook邮箱地址</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">刷新令牌 (Refresh Token) *</label>
                                <textarea id="refreshToken" class="form-input form-textarea" rows="4" placeholder="从Azure应用获取的refresh_token" required></textarea>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    从Azure应用程序注册中获取的刷新令牌，用于OAuth2认证
                                </p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">客户端ID (Client ID) *</label>
                                <input type="text" id="clientId" class="form-input" placeholder="Azure应用的client_id" required>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    Azure应用程序的客户端标识符
                                </p>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    系统会自动识别并使用 IMAP 或 Graph 模式验证账户
                                </p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">认证模式 (auth_mode)</label>
                                <select id="authMode" class="form-input">
                                    <option value="auto" selected>auto（自动识别，推荐）</option>
                                    <option value="imap">imap（仅IMAP）</option>
                                    <option value="graph">graph（仅Graph）</option>
                                </select>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    可手动指定认证模式；默认 auto 会先尝试 IMAP，再回退 Graph
                                </p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">邮箱密码 (mailbox_password，可选)</label>
                                <input type="text" id="mailboxPassword" class="form-input" placeholder="用于 /web/邮箱----邮箱密码 快速取件">
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    如果填写，该账户可通过 /web/{邮箱----邮箱密码} 直接打开邮件列表
                                </p>
                            </div>

                            <div class="form-group">
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <h4 style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600; color: #374151;">📋 获取步骤：</h4>
                                    <ol style="margin: 0; padding-left: 20px; font-size: 0.75rem; color: #6b7280; line-height: 1.5;">
                                        <li>访问 <a href="https://portal.azure.com" target="_blank" style="color: #3b82f6;">Azure Portal</a></li>
                                        <li>注册应用程序并配置权限</li>
                                        <li>获取Client ID和Refresh Token</li>
                                        <li>确保应用有邮件读取权限</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="accountTags">标签 (可选，用逗号分隔)</label>
                                <input type="text" id="accountTags" class="form-control" placeholder="工作,个人,重要">
                            </div>

                            <div class="flex gap-3">
                                <button class="btn btn-primary" onclick="addAccount()" id="addAccountBtn">
                                    <span>➕</span>
                                    添加账户
                                </button>
                                <button class="btn btn-secondary" onclick="clearAddAccountForm()">
                                    <span>🗑️</span>
                                    清空表单
                                </button>
                                <button class="btn btn-secondary" onclick="testAccountConnection()" id="testBtn">
                                    <span>🔍</span>
                                    测试连接
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 批量添加账户页面 -->
                <div id="batchAddPage" class="page hidden">
                    <div class="card">
                        <div class="flex justify-end mb-4">
                            <button class="btn btn-secondary btn-sm" onclick="showPage('accounts')">
                                <span>←</span>
                                返回列表
                            </button>
                        </div>

                        <div style="max-width: 800px;">
                            <div class="form-group">
                                <label class="form-label">批量认证模式 (auth_mode)</label>
                                <select id="batchAuthMode" class="form-input" style="max-width: 320px;">
                                    <option value="auto" selected>auto（自动识别，推荐）</option>
                                    <option value="imap">imap（仅IMAP）</option>
                                    <option value="graph">graph（仅Graph）</option>
                                </select>
                                <p class="text-xs" style="color: #64748b; margin-top: 4px;">
                                    该设置会应用到本次批量添加的每一个账户
                                </p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">批量账户信息</label>
                                <p class="text-sm" style="color: #64748b; margin-bottom: 8px;">
                                    每行格式（支持两种）：<code>邮箱----密码----刷新令牌----客户端ID</code> 或 <code>邮箱----密码----客户端ID----刷新令牌</code>
                                </p>
                                <p class="text-sm" style="color: #64748b; margin-bottom: 12px;">
                                    📧 推荐购买地址（非广告，只是推荐）：
                                    <a target="_blank" href="http://wmemail.com" style="color: #3b82f6; margin: 0 8px;">wmemail.com</a>
                                </p>
                                <textarea id="batchAccounts" class="form-input form-textarea" rows="12" placeholder="example1@outlook.com----password1----refresh_token1----client_id1
example2@outlook.com----password2----client_id2----refresh_token2
example3@outlook.com----password3----refresh_token3----client_id3"></textarea>
                                <p class="text-xs" style="color: #64748b; margin-top: 8px;">
                                    💡 提示：每行一个账户，使用四个连字符(----)分隔字段
                                </p>
                            </div>

                            <div class="form-group">
                                <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <h4 style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600; color: #92400e;">⚠️ 注意事项：</h4>
                                    <ul style="margin: 0; padding-left: 20px; font-size: 0.75rem; color: #92400e; line-height: 1.5;">
                                        <li>确保所有账户信息格式正确</li>
                                        <li>建议先测试少量账户再批量添加</li>
                                        <li>添加过程中请勿关闭页面</li>
                                        <li>失败的账户会在结果中显示</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="flex gap-3">
                                <button class="btn btn-primary" onclick="batchAddAccounts()" id="batchAddBtn">
                                    <span>📦</span>
                                    开始批量添加
                                </button>
                                <button class="btn btn-secondary" onclick="clearBatchForm()">
                                    <span>🗑️</span>
                                    清空表单
                                </button>
                                <button class="btn btn-secondary" onclick="validateBatchFormat()">
                                    <span>✅</span>
                                    验证格式
                                </button>
                                <button class="btn btn-secondary" onclick="loadSampleData()">
                                    <span>📝</span>
                                    加载示例
                                </button>
                            </div>

                            <!-- 批量添加进度 -->
                            <div id="batchProgress" class="hidden" style="margin-top: 24px;">
                                <h4 style="margin-bottom: 12px; font-size: 0.875rem; font-weight: 600;">添加进度：</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="batchProgressFill"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #64748b; margin-top: 8px;">
                                    <span id="batchProgressText">准备中...</span>
                                    <span id="batchProgressCount">0 / 0</span>
                                </div>
                            </div>

                            <!-- 批量添加结果 -->
                            <div id="batchResults" class="hidden" style="margin-top: 24px;">
                                <h4 style="margin-bottom: 12px; font-size: 0.875rem; font-weight: 600;">添加结果：</h4>
                                <div id="batchResultsList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API文档页面 -->
                <div id="apiDocsPage" class="page hidden">
                    <div class="card">
                        <div class="flex justify-end mb-4">
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-sm" onclick="copyApiBaseUrl()">
                                    <span>📋</span>
                                    复制Base URL
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="downloadApiDocs()">
                                    <span>📥</span>
                                    下载文档
                                </button>
                            </div>
                        </div>

                        <div class="api-docs">
                            <!-- API基础信息 -->
                            <div class="api-endpoint">
                                <div class="api-header">
                                    <div>
                                        <h3 style="margin: 0; color: #1f2937;">📡 API基础信息</h3>
                                    </div>
                                </div>
                                <div class="api-body">
                                    <div class="api-section">
                                        <h4>Base URL</h4>
                                        <div class="api-example" id="baseUrlExample">http://localhost:8001</div>
                                    </div>
                                    <div class="api-section">
                                        <h4>认证方式</h4>
                                        <p class="api-description">需先通过管理员登录页登录，系统使用 refresh token + access token 的 HttpOnly Cookie 鉴权。</p>
                                    </div>
                                    <div class="api-section">
                                        <h4>响应格式</h4>
                                        <p class="api-description">所有接口返回JSON格式数据，HTTP状态码表示请求结果。</p>
                                    </div>
                                </div>
                            </div>

                            <div id="openApiEndpoints">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    正在加载OpenAPI文档...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 邮件列表页面 -->
                <div id="emailsPage" class="page hidden">
                    <div class="card">
                        <!-- 账户信息和操作按钮 -->
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="font-semibold">当前账户：
                                    <span id="currentAccountEmail"
                                          class="text-sm font-medium email-copyable"
                                          style="color: #3b82f6; cursor: pointer; position: relative;"
                                          onclick="copyEmailAddress(this.textContent)"
                                          title="点击复制邮箱地址">
                                    </span>
                                    <span class="copy-icon" style="margin-left: 6px; opacity: 0.6; font-size: 0.8em;">📋</span>
                                </h3>
                                <p class="text-sm" style="color: #64748b;">最后更新：<span id="lastUpdateTime">-</span></p>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-sm" onclick="refreshEmails()" id="refreshBtn">
                                    <span>🔄</span>
                                    刷新
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="clearCache()">
                                    <span>🗑️</span>
                                    清除缓存
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="exportEmails()">
                                    <span>📤</span>
                                    导出
                                </button>
                                <button class="btn btn-secondary btn-sm" id="backToAccountsBtn" onclick="backToAccounts()">
                                    <span>←</span>
                                    返回账户
                                </button>
                            </div>
                        </div>

                        <!-- 统计信息 -->
                        <div class="stats-container">
                            <div class="stat-item">
                                <div class="stat-value" id="totalEmailCount">0</div>
                                <div class="stat-label">总邮件数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="unreadEmailCount">0</div>
                                <div class="stat-label">未读邮件</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="todayEmailCount">0</div>
                                <div class="stat-label">今日邮件</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="attachmentEmailCount">0</div>
                                <div class="stat-label">带附件</div>
                            </div>
                        </div>

                        <!-- 搜索和过滤 -->
                        <div class="search-container">
                            <span class="search-icon">🔍</span>
                            <input type="text" class="search-input" id="emailSearch" placeholder="搜索邮件标题、发件人或内容..." onkeyup="searchEmails()">
                        </div>

                        <div class="filter-container">
                            <div class="filter-group">
                                <label class="filter-label">文件夹:</label>
                                <select class="filter-select" id="folderFilter" onchange="applyFilters()">
                                    <option value="all">全部邮件</option>
                                    <option value="inbox">收件箱</option>
                                    <option value="junk">垃圾邮件</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">状态:</label>
                                <select class="filter-select" id="statusFilter" onchange="applyFilters()">
                                    <option value="all">全部状态</option>
                                    <option value="unread">未读</option>
                                    <option value="read">已读</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">时间:</label>
                                <select class="filter-select" id="timeFilter" onchange="applyFilters()">
                                    <option value="all">全部时间</option>
                                    <option value="today">今天</option>
                                    <option value="week">本周</option>
                                    <option value="month">本月</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">附件:</label>
                                <select class="filter-select" id="attachmentFilter" onchange="applyFilters()">
                                    <option value="all">全部</option>
                                    <option value="with">有附件</option>
                                    <option value="without">无附件</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="clearFilters()">
                                <span>🗑️</span>
                                清除筛选
                            </button>
                        </div>

                        <!-- 邮件列表 -->
                        <div id="emailsList" class="email-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                正在加载邮件...
                            </div>
                        </div>

                        <div id="emailsPagination" class="pagination hidden"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 邮件子窗口（页面内） -->
    <div id="emailChildWindowModal" class="email-child-window hidden" role="dialog" aria-modal="true" aria-label="邮件子窗口">
        <div class="email-child-window-mask" data-close-child-window="true"></div>
        <div class="email-child-window-panel">
            <div class="email-child-window-header">
                <div class="email-child-window-title-wrap">
                    <span class="email-child-window-badge">子窗口</span>
                    <h3 id="emailChildWindowTitle">邮件查看</h3>
                </div>
                <div class="email-child-window-actions">
                    <button class="btn btn-secondary btn-sm" type="button" onclick="closeEmailChildWindow()">
                        <span>✖</span>
                        关闭
                    </button>
                </div>
            </div>
            <iframe id="emailChildWindowFrame" class="email-child-window-frame" src="about:blank" title="邮件子窗口内容"></iframe>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- 邮件详情模态框 -->
    <div id="emailModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="emailModalTitle">邮件详情</h3>
                <button class="modal-close" onclick="closeEmailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="emailModalContent">
                    <div class="loading">正在加载邮件详情...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 账户信息模态框 -->
    <div id="accountInfoModal" class="modal">
        <div class="modal-content" style="max-width: 680px;">
            <div class="modal-header">
                <h3 id="accountInfoModalTitle">账户信息</h3>
                <button class="modal-close" onclick="closeAccountInfoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="account-info-grid">
                    <div class="form-group">
                        <label for="accountInfoEmail">邮箱地址</label>
                        <input id="accountInfoEmail" class="form-control" type="text" readonly>
                    </div>
                    <div class="form-group">
                        <label for="accountInfoStatus">账户状态</label>
                        <input id="accountInfoStatus" class="form-control" type="text" readonly>
                    </div>
                    <div class="form-group">
                        <label for="accountInfoAtExpires">AT过期时间</label>
                        <input id="accountInfoAtExpires" class="form-control" type="text" readonly>
                    </div>
                    <div class="form-group">
                        <label for="accountInfoRtExpires">RT过期时间</label>
                        <input id="accountInfoRtExpires" class="form-control" type="text" readonly>
                    </div>
                    <div class="form-group">
                        <label for="accountInfoAuthMode">认证模式</label>
                        <select id="accountInfoAuthMode" class="form-control">
                            <option value="auto">auto（自动识别）</option>
                            <option value="imap">imap</option>
                            <option value="graph">graph</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="accountInfoClientId">客户端ID (client_id)</label>
                        <input id="accountInfoClientId" class="form-control" type="text" placeholder="请输入 client_id">
                    </div>
                </div>
                <div class="form-group">
                    <label for="accountInfoAccessToken">当前访问令牌 (access_token，只读缓存)</label>
                    <textarea id="accountInfoAccessToken" class="form-control form-textarea" rows="3" readonly placeholder="未缓存AT（先取件或刷新RT）"></textarea>
                </div>
                <div class="form-group">
                    <label for="accountInfoRefreshToken">刷新令牌 (refresh_token)</label>
                    <textarea id="accountInfoRefreshToken" class="form-control form-textarea" rows="4" placeholder="请输入 refresh_token"></textarea>
                </div>
                <div class="form-group">
                    <label for="accountInfoMailboxPassword">邮箱密码 (mailbox_password，可选)</label>
                    <input id="accountInfoMailboxPassword" class="form-control" type="text" placeholder="用于 /web/邮箱----邮箱密码 快速取件">
                </div>
                <div class="form-group">
                    <label for="accountInfoTags">标签（逗号分隔）</label>
                    <input id="accountInfoTags" class="form-control" type="text" placeholder="工作,个人,重要">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAccountInfoModal()">取消</button>
                <button class="btn btn-primary" id="saveAccountInfoBtn" onclick="saveAccountInfo()">保存修改</button>
            </div>
        </div>
    </div>

    <!-- 标签管理模态框 -->
    <div id="tagsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>管理账户标签</h3>
                <span class="close" onclick="closeTagsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="currentTags">当前标签</label>
                    <div id="currentTagsList" class="tags-list"></div>
                </div>
                <div class="form-group">
                    <label for="newTag">添加新标签</label>
                    <div class="input-group">
                        <input type="text" id="newTag" class="form-control" placeholder="输入标签名称">
                        <button class="btn btn-primary" onclick="addTag()">添加</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTagsModal()">取消</button>
                <button class="btn btn-primary" onclick="saveAccountTags()">保存</button>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="openInChildWindow()">
            <span>🔗</span>
            在子窗口中打开
        </div>
        <div class="context-menu-item" onclick="copyAccountLink()">
            <span>📋</span>
            复制链接
        </div>
        <div id="contextPinMenuItem" class="context-menu-item" onclick="contextPinAccount()">
            <span id="contextPinMenuIcon">📌</span>
            <span id="contextPinMenuText">挂到左侧</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="contextEditTags()">
            <span>🏷️</span>
            管理标签
        </div>
        <div class="context-menu-item danger" onclick="contextDeleteAccount()">
            <span>🗑️</span>
            删除账户
        </div>
    </div>

    <script src="/static/js/state.js"></script>
    <script src="/static/js/core.js"></script>
    <script src="/static/js/accounts.js"></script>
    <script src="/static/js/api-docs.js"></script>
    <script src="/static/js/emails.js"></script>
    <script src="/static/js/boot.js"></script>
</body>
</html>
